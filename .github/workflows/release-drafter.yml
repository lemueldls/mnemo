name: Release Drafter

on:
  push:
    branches:
      - main
      - dev
  workflow_dispatch:

jobs:
  update_release_draft:
    permissions:
      contents: write
      # write permission is required for autolabeler
      # otherwise, read permission is required at least
      pull-requests: write
    runs-on: ubuntu-latest
    name: Release Drafter
    steps:
      - name: ðŸ”„ Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v5.0.0.0.0

      - name: ðŸ“ Extract version from tauri.conf.json
        id: get-version
        shell: bash
        run: |
          CURRENT_VERSION=$(jq -r '.version' platform/tauri/tauri.conf.json)
          echo "current-version=$CURRENT_VERSION" >> "$GITHUB_OUTPUT"

      - name: ðŸ“ Resolve tag
        id: resolve-tag
        shell: bash
        run: |
          if [ $GITHUB_REF = "refs/heads/main" ]; then
            CURRENT_TAG=v${{ steps.get-version.outputs.current-version }}
          else
            CURRENT_TAG=$GITHUB_REF_NAME
          fi
          echo "current-tag=$CURRENT_TAG" >> "$GITHUB_OUTPUT"

      # - name: Delete drafts
      #   uses: hugo19941994/delete-draft-releases@1bdca1ea7ffb25ae7f468a7bdb40056dae98175e # v1.0.1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Run Release Drafter
        uses: release-drafter/release-drafter@267d2e0268deae5d44f3ba5029dd4d6e85f9d52d # v6.1.1
        with:
          name: Mnemo [${{ steps.resolve-tag.outputs.current-tag }}]
          tag: mnemo-${{ steps.resolve-tag.outputs.current-tag }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
