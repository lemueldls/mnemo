diff --git a/nodejs/index.js b/nodejs/index.js
index 24fe0465bf2198136a02f8753508487d02116342..4a6b3dfac5fcde9529ffaa10c788cfbfdfce6e6f 100644
--- a/nodejs/index.js
+++ b/nodejs/index.js
@@ -1,11 +1,11 @@
 'use strict';
 
-var loroWasm = require("./loro_wasm");
+import * as loroWasm from "./loro_wasm.js";
 
 /**
  * @deprecated Please use LoroDoc
  */
-class Loro extends loroWasm.LoroDoc {
+export class Loro extends loroWasm.LoroDoc {
 }
 const CONTAINER_TYPES = [
     "Map",
@@ -15,7 +15,7 @@ const CONTAINER_TYPES = [
     "MovableList",
     "Counter",
 ];
-function isContainerId(s) {
+export function isContainerId(s) {
     return s.startsWith("cid:");
 }
 /**  Whether the value is a container.
@@ -35,7 +35,7 @@ function isContainerId(s) {
  * isContainer({}); // false
  * ```
  */
-function isContainer(value) {
+export function isContainer(value) {
     if (typeof value !== "object" || value == null) {
         return false;
     }
@@ -62,16 +62,16 @@ function isContainer(value) {
  * getType({}); // "Json"
  * ```
  */
-function getType(value) {
+export function getType(value) {
     if (isContainer(value)) {
         return value.kind();
     }
     return "Json";
 }
-function newContainerID(id, type) {
+export function newContainerID(id, type) {
     return `cid:${id.counter}@${id.peer}:${type}`;
 }
-function newRootContainerID(name, type) {
+export function newRootContainerID(name, type) {
     return `cid:root-${name}:${type}`;
 }
 /**
@@ -82,7 +82,7 @@ function newRootContainerID(name, type) {
  * If we don't receive a state update from a peer within the timeout, we will remove their state.
  * The timeout is in milliseconds. This can be used to handle the offline state of a peer.
  */
-class Awareness {
+export class Awareness {
     constructor(peer, timeout = 30000) {
         this.listeners = new Set();
         this.inner = new loroWasm.AwarenessWasm(peer, timeout);
@@ -184,7 +184,7 @@ class Awareness {
  * store2.apply(encoded);
  * ```
  */
-class EphemeralStore {
+export class EphemeralStore {
     constructor(timeout = 30000) {
         this.inner = new loroWasm.EphemeralStoreWasm(timeout);
         this.timeout = timeout;
@@ -292,7 +292,7 @@ loroWasm.LoroDoc.prototype.toJsonWithReplacer = function (replacer) {
     const layer = doc.getShallowValue();
     return run(layer);
 };
-function idStrToId(idStr) {
+export function idStrToId(idStr) {
     const [counter, peer] = idStr.split("@");
     return {
         counter: parseInt(counter),
@@ -300,19 +300,6 @@ function idStrToId(idStr) {
     };
 }
 
-exports.Awareness = Awareness;
-exports.EphemeralStore = EphemeralStore;
-exports.Loro = Loro;
-exports.getType = getType;
-exports.idStrToId = idStrToId;
-exports.isContainer = isContainer;
-exports.isContainerId = isContainerId;
-exports.newContainerID = newContainerID;
-exports.newRootContainerID = newRootContainerID;
-Object.keys(loroWasm).forEach(function (k) {
-    if (k !== 'default' && !Object.prototype.hasOwnProperty.call(exports, k)) Object.defineProperty(exports, k, {
-        enumerable: true,
-        get: function () { return loroWasm[k]; }
-    });
-});
+export * from "./loro_wasm.js";
+
 //# sourceMappingURL=index.js.map
diff --git a/nodejs/loro_wasm.js b/nodejs/loro_wasm.js
index 3d22132c9b694a7b377ac06bd13cc80dcc86fbc2..18d43df956ec9eb1f2e9b21ed01afa5355f076e1 100644
--- a/nodejs/loro_wasm.js
+++ b/nodejs/loro_wasm.js
@@ -1,8 +1,9 @@
 
 let imports = {};
-imports['__wbindgen_placeholder__'] = module.exports;
 let wasm;
-const { TextEncoder, TextDecoder } = require(`util`);
+import { TextEncoder, TextDecoder } from 'util';
+import { readFileSync } from 'fs';
+import { webcrypto } from 'crypto';
 
 const heap = new Array(128).fill(undefined);
 
@@ -249,7 +250,7 @@ function getArrayJsValueFromWasm0(ptr, len) {
  * Get the version of Loro
  * @returns {string}
  */
-module.exports.LORO_VERSION = function() {
+export const LORO_VERSION = function() {
     let deferred1_0;
     let deferred1_1;
     try {
@@ -266,7 +267,7 @@ module.exports.LORO_VERSION = function() {
     }
 };
 
-module.exports.run = function() {
+export const run = function() {
     wasm.run();
 };
 
@@ -283,7 +284,7 @@ function passArrayJsValueToWasm0(array, malloc) {
  * @param {({ peer: PeerID, counter: number })[]} frontiers
  * @returns {Uint8Array}
  */
-module.exports.encodeFrontiers = function(frontiers) {
+export const encodeFrontiers = function(frontiers) {
     try {
         const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);
         const ptr0 = passArrayJsValueToWasm0(frontiers, wasm.__wbindgen_export_0);
@@ -308,7 +309,7 @@ module.exports.encodeFrontiers = function(frontiers) {
  * @param {Uint8Array} bytes
  * @returns {{ peer: PeerID, counter: number }[]}
  */
-module.exports.decodeFrontiers = function(bytes) {
+export const decodeFrontiers = function(bytes) {
     try {
         const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);
         const ptr0 = passArray8ToWasm0(bytes, wasm.__wbindgen_export_0);
@@ -329,7 +330,7 @@ module.exports.decodeFrontiers = function(bytes) {
 /**
  * Enable debug info of Loro
  */
-module.exports.setDebug = function() {
+export const setDebug = function() {
     wasm.setDebug();
 };
 
@@ -361,7 +362,7 @@ function _assertClass(instance, klass) {
  * @param {boolean} check_checksum
  * @returns {ImportBlobMetadata}
  */
-module.exports.decodeImportBlobMeta = function(blob, check_checksum) {
+export const decodeImportBlobMeta = function(blob, check_checksum) {
     try {
         const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);
         const ptr0 = passArray8ToWasm0(blob, wasm.__wbindgen_export_0);
@@ -401,7 +402,7 @@ module.exports.decodeImportBlobMeta = function(blob, check_checksum) {
  * @param {any} version_range
  * @returns {JsonSchema}
  */
-module.exports.redactJsonUpdates = function(json_updates, version_range) {
+export const redactJsonUpdates = function(json_updates, version_range) {
     try {
         const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);
         wasm.redactJsonUpdates(retptr, addHeapObject(json_updates), addHeapObject(version_range));
@@ -623,7 +624,9 @@ class AwarenessWasm {
         }
     }
 }
-module.exports.AwarenessWasm = AwarenessWasm;
+export { AwarenessWasm };
+
+
 
 const ChangeModifierFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -669,7 +672,8 @@ class ChangeModifier {
         return ChangeModifier.__wrap(ret);
     }
 }
-module.exports.ChangeModifier = ChangeModifier;
+export { ChangeModifier };
+
 
 const CursorFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -802,7 +806,9 @@ class Cursor {
         return takeObject(ret);
     }
 }
-module.exports.Cursor = Cursor;
+export { Cursor };
+
+
 
 const EphemeralStoreWasmFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -956,7 +962,8 @@ class EphemeralStoreWasm {
         }
     }
 }
-module.exports.EphemeralStoreWasm = EphemeralStoreWasm;
+export { EphemeralStoreWasm };
+
 
 const LoroCounterFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -1113,7 +1120,9 @@ class LoroCounter {
         return ret;
     }
 }
-module.exports.LoroCounter = LoroCounter;
+export { LoroCounter };
+
+
 
 const LoroDocFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -3118,7 +3127,8 @@ class LoroDoc {
         }
     }
 }
-module.exports.LoroDoc = LoroDoc;
+export { LoroDoc };
+
 
 const LoroListFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -3559,7 +3569,9 @@ class LoroList {
         return takeObject(ret);
     }
 }
-module.exports.LoroList = LoroList;
+export { LoroList };
+
+
 
 const LoroMapFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -4042,7 +4054,9 @@ class LoroMap {
         return takeObject(ret);
     }
 }
-module.exports.LoroMap = LoroMap;
+export { LoroMap };
+
+
 
 const LoroMovableListFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -4574,7 +4588,9 @@ class LoroMovableList {
         return takeObject(ret);
     }
 }
-module.exports.LoroMovableList = LoroMovableList;
+export { LoroMovableList };
+
+
 
 const LoroTextFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -5257,7 +5273,8 @@ class LoroText {
         return takeObject(ret);
     }
 }
-module.exports.LoroText = LoroText;
+export { LoroText };
+
 
 const LoroTreeFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -5751,7 +5768,9 @@ class LoroTree {
         return takeObject(ret);
     }
 }
-module.exports.LoroTree = LoroTree;
+export { LoroTree };
+
+
 
 const LoroTreeNodeFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -6078,7 +6097,8 @@ class LoroTreeNode {
         return takeObject(ret);
     }
 }
-module.exports.LoroTreeNode = LoroTreeNode;
+export { LoroTreeNode };
+
 
 const UndoManagerFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -6261,7 +6281,9 @@ class UndoManager {
         wasm.undomanager_clear(this.__wbg_ptr);
     }
 }
-module.exports.UndoManager = UndoManager;
+export { UndoManager };
+
+
 
 const VersionVectorFinalization = (typeof FinalizationRegistry === 'undefined')
     ? { register: () => {}, unregister: () => {} }
@@ -6472,9 +6494,10 @@ class VersionVector {
         return ret >>> 0;
     }
 }
-module.exports.VersionVector = VersionVector;
+export { VersionVector };
+
 
-module.exports.__wbg_String_8f0eb39a4a4c2f66 = function(arg0, arg1) {
+export const __wbg_String_8f0eb39a4a4c2f66 = function(arg0, arg1) {
     const ret = String(getObject(arg1));
     const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_export_0, wasm.__wbindgen_export_1);
     const len1 = WASM_VECTOR_LEN;
@@ -6482,67 +6505,67 @@ module.exports.__wbg_String_8f0eb39a4a4c2f66 = function(arg0, arg1) {
     getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);
 };
 
-module.exports.__wbg_apply_9bb7fe8fff013a3f = function() { return handleError(function (arg0, arg1, arg2) {
+export const __wbg_apply_9bb7fe8fff013a3f = function() { return handleError(function (arg0, arg1, arg2) {
     const ret = Reflect.apply(getObject(arg0), getObject(arg1), getObject(arg2));
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_buffer_ef9774282e5dab94 = function(arg0) {
+export const __wbg_buffer_ef9774282e5dab94 = function(arg0) {
     const ret = getObject(arg0).buffer;
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_call_0ad083564791763a = function() { return handleError(function (arg0, arg1) {
+export const __wbg_call_0ad083564791763a = function() { return handleError(function (arg0, arg1) {
     const ret = getObject(arg0).call(getObject(arg1));
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_call_a34b6b4765f27be0 = function() { return handleError(function (arg0, arg1, arg2) {
+export const __wbg_call_a34b6b4765f27be0 = function() { return handleError(function (arg0, arg1, arg2) {
     const ret = getObject(arg0).call(getObject(arg1), getObject(arg2));
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_call_d00953b926be4879 = function() { return handleError(function (arg0, arg1, arg2, arg3, arg4) {
+export const __wbg_call_d00953b926be4879 = function() { return handleError(function (arg0, arg1, arg2, arg3, arg4) {
     const ret = getObject(arg0).call(getObject(arg1), getObject(arg2), getObject(arg3), getObject(arg4));
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_call_efe5a4db7065d1a2 = function() { return handleError(function (arg0, arg1, arg2, arg3) {
+export const __wbg_call_efe5a4db7065d1a2 = function() { return handleError(function (arg0, arg1, arg2, arg3) {
     const ret = getObject(arg0).call(getObject(arg1), getObject(arg2), getObject(arg3));
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_changemodifier_new = function(arg0) {
+export const __wbg_changemodifier_new = function(arg0) {
     const ret = ChangeModifier.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_crypto_ed58b8e10a292839 = function(arg0) {
+export const __wbg_crypto_ed58b8e10a292839 = function(arg0) {
     const ret = getObject(arg0).crypto;
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_cursor_new = function(arg0) {
+export const __wbg_cursor_new = function(arg0) {
     const ret = Cursor.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_done_f4c254830a095eaf = function(arg0) {
+export const __wbg_done_f4c254830a095eaf = function(arg0) {
     const ret = getObject(arg0).done;
     return ret;
 };
 
-module.exports.__wbg_entries_4dce6361e3ba6fbc = function(arg0) {
+export const __wbg_entries_4dce6361e3ba6fbc = function(arg0) {
     const ret = getObject(arg0).entries();
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_entries_83beb641792ccb9c = function(arg0) {
+export const __wbg_entries_83beb641792ccb9c = function(arg0) {
     const ret = Object.entries(getObject(arg0));
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_error_7534b8e9a36f1ab4 = function(arg0, arg1) {
+export const __wbg_error_7534b8e9a36f1ab4 = function(arg0, arg1) {
     let deferred0_0;
     let deferred0_1;
     try {
@@ -6554,50 +6577,50 @@ module.exports.__wbg_error_7534b8e9a36f1ab4 = function(arg0, arg1) {
     }
 };
 
-module.exports.__wbg_error_9912f7d6d7835a4b = function(arg0, arg1) {
+export const __wbg_error_9912f7d6d7835a4b = function(arg0, arg1) {
     console.error(getStringFromWasm0(arg0, arg1));
 };
 
-module.exports.__wbg_from_3aa0fcaa8eef0104 = function(arg0) {
+export const __wbg_from_3aa0fcaa8eef0104 = function(arg0) {
     const ret = Array.from(getObject(arg0));
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_getRandomValues_bcb4912f16000dc4 = function() { return handleError(function (arg0, arg1) {
+export const __wbg_getRandomValues_bcb4912f16000dc4 = function() { return handleError(function (arg0, arg1) {
     getObject(arg0).getRandomValues(getObject(arg1));
 }, arguments) };
 
-module.exports.__wbg_get_0c3cc364764a0b98 = function(arg0, arg1) {
+export const __wbg_get_0c3cc364764a0b98 = function(arg0, arg1) {
     const ret = getObject(arg0)[arg1 >>> 0];
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_get_b996a12be035ef4f = function() { return handleError(function (arg0, arg1) {
+export const __wbg_get_b996a12be035ef4f = function() { return handleError(function (arg0, arg1) {
     const ret = Reflect.get(getObject(arg0), getObject(arg1));
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_getindex_a471648b3037c750 = function(arg0, arg1) {
+export const __wbg_getindex_a471648b3037c750 = function(arg0, arg1) {
     const ret = getObject(arg0)[arg1 >>> 0];
     return ret;
 };
 
-module.exports.__wbg_getwithrefkey_1dc361bd10053bfe = function(arg0, arg1) {
+export const __wbg_getwithrefkey_1dc361bd10053bfe = function(arg0, arg1) {
     const ret = getObject(arg0)[getObject(arg1)];
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_globalThis_6b4d52a0b6aaeaea = function() { return handleError(function () {
+export const __wbg_globalThis_6b4d52a0b6aaeaea = function() { return handleError(function () {
     const ret = globalThis.globalThis;
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_global_49324ce12193de77 = function() { return handleError(function () {
+export const __wbg_global_49324ce12193de77 = function() { return handleError(function () {
     const ret = global.global;
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_instanceof_ArrayBuffer_ff40e55b5978e215 = function(arg0) {
+export const __wbg_instanceof_ArrayBuffer_ff40e55b5978e215 = function(arg0) {
     let result;
     try {
         result = getObject(arg0) instanceof ArrayBuffer;
@@ -6608,7 +6631,7 @@ module.exports.__wbg_instanceof_ArrayBuffer_ff40e55b5978e215 = function(arg0) {
     return ret;
 };
 
-module.exports.__wbg_instanceof_Map_0f3f3653f757ced1 = function(arg0) {
+export const __wbg_instanceof_Map_0f3f3653f757ced1 = function(arg0) {
     let result;
     try {
         result = getObject(arg0) instanceof Map;
@@ -6619,7 +6642,7 @@ module.exports.__wbg_instanceof_Map_0f3f3653f757ced1 = function(arg0) {
     return ret;
 };
 
-module.exports.__wbg_instanceof_Object_9108547bac1f91b1 = function(arg0) {
+export const __wbg_instanceof_Object_9108547bac1f91b1 = function(arg0) {
     let result;
     try {
         result = getObject(arg0) instanceof Object;
@@ -6630,7 +6653,7 @@ module.exports.__wbg_instanceof_Object_9108547bac1f91b1 = function(arg0) {
     return ret;
 };
 
-module.exports.__wbg_instanceof_Uint8Array_db97368f94b1373f = function(arg0) {
+export const __wbg_instanceof_Uint8Array_db97368f94b1373f = function(arg0) {
     let result;
     try {
         result = getObject(arg0) instanceof Uint8Array;
@@ -6641,32 +6664,32 @@ module.exports.__wbg_instanceof_Uint8Array_db97368f94b1373f = function(arg0) {
     return ret;
 };
 
-module.exports.__wbg_isArray_8738f1062fa88586 = function(arg0) {
+export const __wbg_isArray_8738f1062fa88586 = function(arg0) {
     const ret = Array.isArray(getObject(arg0));
     return ret;
 };
 
-module.exports.__wbg_isSafeInteger_a1b3e0811faecf2f = function(arg0) {
+export const __wbg_isSafeInteger_a1b3e0811faecf2f = function(arg0) {
     const ret = Number.isSafeInteger(getObject(arg0));
     return ret;
 };
 
-module.exports.__wbg_iterator_c0c688f37fa815e6 = function() {
+export const __wbg_iterator_c0c688f37fa815e6 = function() {
     const ret = Symbol.iterator;
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_length_12246a78d2f65d3a = function(arg0) {
+export const __wbg_length_12246a78d2f65d3a = function(arg0) {
     const ret = getObject(arg0).length;
     return ret;
 };
 
-module.exports.__wbg_length_c24da17096edfe57 = function(arg0) {
+export const __wbg_length_c24da17096edfe57 = function(arg0) {
     const ret = getObject(arg0).length;
     return ret;
 };
 
-module.exports.__wbg_log_0cc1b7768397bcfe = function(arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7) {
+export const __wbg_log_0cc1b7768397bcfe = function(arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7) {
     let deferred0_0;
     let deferred0_1;
     try {
@@ -6678,11 +6701,11 @@ module.exports.__wbg_log_0cc1b7768397bcfe = function(arg0, arg1, arg2, arg3, arg
     }
 };
 
-module.exports.__wbg_log_0fd6c49475c7bece = function(arg0, arg1) {
+export const __wbg_log_0fd6c49475c7bece = function(arg0, arg1) {
     console.log(getStringFromWasm0(arg0, arg1));
 };
 
-module.exports.__wbg_log_cb9e190acc5753fb = function(arg0, arg1) {
+export const __wbg_log_cb9e190acc5753fb = function(arg0, arg1) {
     let deferred0_0;
     let deferred0_1;
     try {
@@ -6694,46 +6717,46 @@ module.exports.__wbg_log_cb9e190acc5753fb = function(arg0, arg1) {
     }
 };
 
-module.exports.__wbg_lorocounter_new = function(arg0) {
+export const __wbg_lorocounter_new = function(arg0) {
     const ret = LoroCounter.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_lorolist_new = function(arg0) {
+export const __wbg_lorolist_new = function(arg0) {
     const ret = LoroList.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_loromap_new = function(arg0) {
+export const __wbg_loromap_new = function(arg0) {
     const ret = LoroMap.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_loromovablelist_new = function(arg0) {
+export const __wbg_loromovablelist_new = function(arg0) {
     const ret = LoroMovableList.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_lorotext_new = function(arg0) {
+export const __wbg_lorotext_new = function(arg0) {
     const ret = LoroText.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_lorotree_new = function(arg0) {
+export const __wbg_lorotree_new = function(arg0) {
     const ret = LoroTree.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_lorotreenode_new = function(arg0) {
+export const __wbg_lorotreenode_new = function(arg0) {
     const ret = LoroTreeNode.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_mark_7438147ce31e9d4b = function(arg0, arg1) {
+export const __wbg_mark_7438147ce31e9d4b = function(arg0, arg1) {
     performance.mark(getStringFromWasm0(arg0, arg1));
 };
 
-module.exports.__wbg_measure_fb7825c11612c823 = function() { return handleError(function (arg0, arg1, arg2, arg3) {
+export const __wbg_measure_fb7825c11612c823 = function() { return handleError(function (arg0, arg1, arg2, arg3) {
     let deferred0_0;
     let deferred0_1;
     let deferred1_0;
@@ -6750,137 +6773,137 @@ module.exports.__wbg_measure_fb7825c11612c823 = function() { return handleError(
     }
 }, arguments) };
 
-module.exports.__wbg_msCrypto_0a36e2ec3a343d26 = function(arg0) {
+export const __wbg_msCrypto_0a36e2ec3a343d26 = function(arg0) {
     const ret = getObject(arg0).msCrypto;
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_new_518e2184725aa711 = function() {
+export const __wbg_new_518e2184725aa711 = function() {
     const ret = new Map();
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_new_59845962d1127937 = function(arg0) {
+export const __wbg_new_59845962d1127937 = function(arg0) {
     const ret = new Uint8Array(getObject(arg0));
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_new_67abf4a77618ee3e = function() {
+export const __wbg_new_67abf4a77618ee3e = function() {
     const ret = new Object();
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_new_8a6f238a6ece86ea = function() {
+export const __wbg_new_8a6f238a6ece86ea = function() {
     const ret = new Error();
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_new_e2d07398d7689006 = function() {
+export const __wbg_new_e2d07398d7689006 = function() {
     const ret = new Array();
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_newnoargs_a136448eeb7d48ac = function(arg0, arg1) {
+export const __wbg_newnoargs_a136448eeb7d48ac = function(arg0, arg1) {
     const ret = new Function(getStringFromWasm0(arg0, arg1));
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_newwithbyteoffsetandlength_84908302a4c137cf = function(arg0, arg1, arg2) {
+export const __wbg_newwithbyteoffsetandlength_84908302a4c137cf = function(arg0, arg1, arg2) {
     const ret = new Uint8Array(getObject(arg0), arg1 >>> 0, arg2 >>> 0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_newwithlength_4c216eaaf23f2f9a = function(arg0) {
+export const __wbg_newwithlength_4c216eaaf23f2f9a = function(arg0) {
     const ret = new Uint8Array(arg0 >>> 0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_newwithlength_88b49de1eb24d63e = function(arg0) {
+export const __wbg_newwithlength_88b49de1eb24d63e = function(arg0) {
     const ret = new Array(arg0 >>> 0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_next_928df8c15fc0c9b0 = function(arg0) {
+export const __wbg_next_928df8c15fc0c9b0 = function(arg0) {
     const ret = getObject(arg0).next;
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_next_9dc0926f351c7090 = function() { return handleError(function (arg0) {
+export const __wbg_next_9dc0926f351c7090 = function() { return handleError(function (arg0) {
     const ret = getObject(arg0).next();
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_node_02999533c4ea02e3 = function(arg0) {
+export const __wbg_node_02999533c4ea02e3 = function(arg0) {
     const ret = getObject(arg0).node;
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_now_439b66158bc4f246 = function() {
+export const __wbg_now_439b66158bc4f246 = function() {
     const ret = Date.now();
     return ret;
 };
 
-module.exports.__wbg_ownKeys_b16312a839a4152c = function() { return handleError(function (arg0) {
+export const __wbg_ownKeys_b16312a839a4152c = function() { return handleError(function (arg0) {
     const ret = Reflect.ownKeys(getObject(arg0));
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_process_5c1d670bc53614b8 = function(arg0) {
+export const __wbg_process_5c1d670bc53614b8 = function(arg0) {
     const ret = getObject(arg0).process;
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_push_e7d7247e69dad3ee = function(arg0, arg1) {
+export const __wbg_push_e7d7247e69dad3ee = function(arg0, arg1) {
     const ret = getObject(arg0).push(getObject(arg1));
     return ret;
 };
 
-module.exports.__wbg_randomFillSync_ab2cfe79ebbf2740 = function() { return handleError(function (arg0, arg1) {
+export const __wbg_randomFillSync_ab2cfe79ebbf2740 = function() { return handleError(function (arg0, arg1) {
     getObject(arg0).randomFillSync(takeObject(arg1));
 }, arguments) };
 
-module.exports.__wbg_require_79b1e9274cde3c87 = function() { return handleError(function () {
+export const __wbg_require_79b1e9274cde3c87 = function() { return handleError(function () {
     const ret = module.require;
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_resolve_267ff08e7e1d2ce4 = function(arg0) {
+export const __wbg_resolve_267ff08e7e1d2ce4 = function(arg0) {
     const ret = Promise.resolve(getObject(arg0));
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_self_cca3ca60d61220f4 = function() { return handleError(function () {
+export const __wbg_self_cca3ca60d61220f4 = function() { return handleError(function () {
     const ret = self.self;
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbg_set_1b50d2de855a9d50 = function() { return handleError(function (arg0, arg1, arg2) {
+export const __wbg_set_1b50d2de855a9d50 = function() { return handleError(function (arg0, arg1, arg2) {
     const ret = Reflect.set(getObject(arg0), getObject(arg1), getObject(arg2));
     return ret;
 }, arguments) };
 
-module.exports.__wbg_set_393f510a6b7e9da5 = function(arg0, arg1, arg2) {
+export const __wbg_set_393f510a6b7e9da5 = function(arg0, arg1, arg2) {
     const ret = getObject(arg0).set(getObject(arg1), getObject(arg2));
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_set_3f1d0b984ed272ed = function(arg0, arg1, arg2) {
+export const __wbg_set_3f1d0b984ed272ed = function(arg0, arg1, arg2) {
     getObject(arg0)[takeObject(arg1)] = takeObject(arg2);
 };
 
-module.exports.__wbg_set_5deee49b10b2b780 = function(arg0, arg1, arg2) {
+export const __wbg_set_5deee49b10b2b780 = function(arg0, arg1, arg2) {
     getObject(arg0).set(getObject(arg1), arg2 >>> 0);
 };
 
-module.exports.__wbg_set_93ba9407b5476ec6 = function(arg0, arg1, arg2) {
+export const __wbg_set_93ba9407b5476ec6 = function(arg0, arg1, arg2) {
     getObject(arg0)[arg1 >>> 0] = takeObject(arg2);
 };
 
-module.exports.__wbg_setindex_e0b7b31bfc87ba3f = function(arg0, arg1, arg2) {
+export const __wbg_setindex_e0b7b31bfc87ba3f = function(arg0, arg1, arg2) {
     getObject(arg0)[arg1 >>> 0] = arg2;
 };
 
-module.exports.__wbg_stack_0ed75d68575b0f3c = function(arg0, arg1) {
+export const __wbg_stack_0ed75d68575b0f3c = function(arg0, arg1) {
     const ret = getObject(arg1).stack;
     const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_export_0, wasm.__wbindgen_export_1);
     const len1 = WASM_VECTOR_LEN;
@@ -6888,65 +6911,65 @@ module.exports.__wbg_stack_0ed75d68575b0f3c = function(arg0, arg1) {
     getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);
 };
 
-module.exports.__wbg_subarray_2dc34705c0dc7cdb = function(arg0, arg1, arg2) {
+export const __wbg_subarray_2dc34705c0dc7cdb = function(arg0, arg1, arg2) {
     const ret = getObject(arg0).subarray(arg1 >>> 0, arg2 >>> 0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_then_84907e7a6730461e = function(arg0, arg1) {
+export const __wbg_then_84907e7a6730461e = function(arg0, arg1) {
     const ret = getObject(arg0).then(getObject(arg1));
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_value_51f8a88d4a1805fb = function(arg0) {
+export const __wbg_value_51f8a88d4a1805fb = function(arg0) {
     const ret = getObject(arg0).value;
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_versions_c71aa1626a93e0a1 = function(arg0) {
+export const __wbg_versions_c71aa1626a93e0a1 = function(arg0) {
     const ret = getObject(arg0).versions;
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_versionvector_new = function(arg0) {
+export const __wbg_versionvector_new = function(arg0) {
     const ret = VersionVector.__wrap(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbg_window_2aba046d3fc4ad7c = function() { return handleError(function () {
+export const __wbg_window_2aba046d3fc4ad7c = function() { return handleError(function () {
     const ret = window.window;
     return addHeapObject(ret);
 }, arguments) };
 
-module.exports.__wbindgen_as_number = function(arg0) {
+export const __wbindgen_as_number = function(arg0) {
     const ret = +getObject(arg0);
     return ret;
 };
 
-module.exports.__wbindgen_bigint_from_i64 = function(arg0) {
+export const __wbindgen_bigint_from_i64 = function(arg0) {
     const ret = arg0;
     return addHeapObject(ret);
 };
 
-module.exports.__wbindgen_bigint_from_u64 = function(arg0) {
+export const __wbindgen_bigint_from_u64 = function(arg0) {
     const ret = BigInt.asUintN(64, arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbindgen_bigint_get_as_i64 = function(arg0, arg1) {
+export const __wbindgen_bigint_get_as_i64 = function(arg0, arg1) {
     const v = getObject(arg1);
     const ret = typeof(v) === 'bigint' ? v : undefined;
     getDataViewMemory0().setBigInt64(arg0 + 8 * 1, isLikeNone(ret) ? BigInt(0) : ret, true);
     getDataViewMemory0().setInt32(arg0 + 4 * 0, !isLikeNone(ret), true);
 };
 
-module.exports.__wbindgen_boolean_get = function(arg0) {
+export const __wbindgen_boolean_get = function(arg0) {
     const v = getObject(arg0);
     const ret = typeof(v) === 'boolean' ? (v ? 1 : 0) : 2;
     return ret;
 };
 
-module.exports.__wbindgen_cb_drop = function(arg0) {
+export const __wbindgen_cb_drop = function(arg0) {
     const obj = takeObject(arg0).original;
     if (obj.cnt-- == 1) {
         obj.a = 0;
@@ -6956,17 +6979,17 @@ module.exports.__wbindgen_cb_drop = function(arg0) {
     return ret;
 };
 
-module.exports.__wbindgen_closure_wrapper563 = function(arg0, arg1, arg2) {
+export const __wbindgen_closure_wrapper563 = function(arg0, arg1, arg2) {
     const ret = makeMutClosure(arg0, arg1, 8, __wbg_adapter_60);
     return addHeapObject(ret);
 };
 
-module.exports.__wbindgen_closure_wrapper566 = function(arg0, arg1, arg2) {
+export const __wbindgen_closure_wrapper566 = function(arg0, arg1, arg2) {
     const ret = makeMutClosure(arg0, arg1, 10, __wbg_adapter_63);
     return addHeapObject(ret);
 };
 
-module.exports.__wbindgen_debug_string = function(arg0, arg1) {
+export const __wbindgen_debug_string = function(arg0, arg1) {
     const ret = debugString(getObject(arg1));
     const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_export_0, wasm.__wbindgen_export_1);
     const len1 = WASM_VECTOR_LEN;
@@ -6974,98 +6997,98 @@ module.exports.__wbindgen_debug_string = function(arg0, arg1) {
     getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);
 };
 
-module.exports.__wbindgen_error_new = function(arg0, arg1) {
+export const __wbindgen_error_new = function(arg0, arg1) {
     const ret = new Error(getStringFromWasm0(arg0, arg1));
     return addHeapObject(ret);
 };
 
-module.exports.__wbindgen_in = function(arg0, arg1) {
+export const __wbindgen_in = function(arg0, arg1) {
     const ret = getObject(arg0) in getObject(arg1);
     return ret;
 };
 
-module.exports.__wbindgen_is_array = function(arg0) {
+export const __wbindgen_is_array = function(arg0) {
     const ret = Array.isArray(getObject(arg0));
     return ret;
 };
 
-module.exports.__wbindgen_is_bigint = function(arg0) {
+export const __wbindgen_is_bigint = function(arg0) {
     const ret = typeof(getObject(arg0)) === 'bigint';
     return ret;
 };
 
-module.exports.__wbindgen_is_falsy = function(arg0) {
+export const __wbindgen_is_falsy = function(arg0) {
     const ret = !getObject(arg0);
     return ret;
 };
 
-module.exports.__wbindgen_is_function = function(arg0) {
+export const __wbindgen_is_function = function(arg0) {
     const ret = typeof(getObject(arg0)) === 'function';
     return ret;
 };
 
-module.exports.__wbindgen_is_null = function(arg0) {
+export const __wbindgen_is_null = function(arg0) {
     const ret = getObject(arg0) === null;
     return ret;
 };
 
-module.exports.__wbindgen_is_object = function(arg0) {
+export const __wbindgen_is_object = function(arg0) {
     const val = getObject(arg0);
     const ret = typeof(val) === 'object' && val !== null;
     return ret;
 };
 
-module.exports.__wbindgen_is_string = function(arg0) {
+export const __wbindgen_is_string = function(arg0) {
     const ret = typeof(getObject(arg0)) === 'string';
     return ret;
 };
 
-module.exports.__wbindgen_is_undefined = function(arg0) {
+export const __wbindgen_is_undefined = function(arg0) {
     const ret = getObject(arg0) === undefined;
     return ret;
 };
 
-module.exports.__wbindgen_jsval_eq = function(arg0, arg1) {
+export const __wbindgen_jsval_eq = function(arg0, arg1) {
     const ret = getObject(arg0) === getObject(arg1);
     return ret;
 };
 
-module.exports.__wbindgen_jsval_loose_eq = function(arg0, arg1) {
+export const __wbindgen_jsval_loose_eq = function(arg0, arg1) {
     const ret = getObject(arg0) == getObject(arg1);
     return ret;
 };
 
-module.exports.__wbindgen_memory = function() {
+export const __wbindgen_memory = function() {
     const ret = wasm.memory;
     return addHeapObject(ret);
 };
 
-module.exports.__wbindgen_number_get = function(arg0, arg1) {
+export const __wbindgen_number_get = function(arg0, arg1) {
     const obj = getObject(arg1);
     const ret = typeof(obj) === 'number' ? obj : undefined;
     getDataViewMemory0().setFloat64(arg0 + 8 * 1, isLikeNone(ret) ? 0 : ret, true);
     getDataViewMemory0().setInt32(arg0 + 4 * 0, !isLikeNone(ret), true);
 };
 
-module.exports.__wbindgen_number_new = function(arg0) {
+export const __wbindgen_number_new = function(arg0) {
     const ret = arg0;
     return addHeapObject(ret);
 };
 
-module.exports.__wbindgen_object_clone_ref = function(arg0) {
+export const __wbindgen_object_clone_ref = function(arg0) {
     const ret = getObject(arg0);
     return addHeapObject(ret);
 };
 
-module.exports.__wbindgen_object_drop_ref = function(arg0) {
+export const __wbindgen_object_drop_ref = function(arg0) {
     takeObject(arg0);
 };
 
-module.exports.__wbindgen_rethrow = function(arg0) {
+export const __wbindgen_rethrow = function(arg0) {
     throw takeObject(arg0);
 };
 
-module.exports.__wbindgen_string_get = function(arg0, arg1) {
+export const __wbindgen_string_get = function(arg0, arg1) {
     const obj = getObject(arg1);
     const ret = typeof(obj) === 'string' ? obj : undefined;
     var ptr1 = isLikeNone(ret) ? 0 : passStringToWasm0(ret, wasm.__wbindgen_export_0, wasm.__wbindgen_export_1);
@@ -7074,37 +7097,178 @@ module.exports.__wbindgen_string_get = function(arg0, arg1) {
     getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);
 };
 
-module.exports.__wbindgen_string_new = function(arg0, arg1) {
+export const __wbindgen_string_new = function(arg0, arg1) {
     const ret = getStringFromWasm0(arg0, arg1);
     return addHeapObject(ret);
 };
 
-module.exports.__wbindgen_throw = function(arg0, arg1) {
+export const __wbindgen_throw = function(arg0, arg1) {
     throw new Error(getStringFromWasm0(arg0, arg1));
 };
 
-module.exports.__wbindgen_typeof = function(arg0) {
+export const __wbindgen_typeof = function(arg0) {
     const ret = typeof getObject(arg0);
     return addHeapObject(ret);
 };
 
-const path = require('path').join(__dirname, 'loro_wasm_bg.wasm');
-const bytes = require('fs').readFileSync(path);
+const path = new URL('./loro_wasm_bg.wasm', import.meta.url);
+const bytes = readFileSync(path);
+
+// Create moduleExports object for WASM binding compatibility
+const moduleExports = {
+    __wbg_String_8f0eb39a4a4c2f66,
+    __wbg_apply_9bb7fe8fff013a3f,
+    __wbg_buffer_ef9774282e5dab94,
+    __wbg_call_0ad083564791763a,
+    __wbg_call_a34b6b4765f27be0,
+    __wbg_call_d00953b926be4879,
+    __wbg_call_efe5a4db7065d1a2,
+    __wbg_changemodifier_new,
+    __wbg_crypto_ed58b8e10a292839,
+    __wbg_cursor_new,
+    __wbg_done_f4c254830a095eaf,
+    __wbg_entries_4dce6361e3ba6fbc,
+    __wbg_entries_83beb641792ccb9c,
+    __wbg_error_7534b8e9a36f1ab4,
+    __wbg_error_9912f7d6d7835a4b,
+    __wbg_from_3aa0fcaa8eef0104,
+    __wbg_getRandomValues_bcb4912f16000dc4,
+    __wbg_get_0c3cc364764a0b98,
+    __wbg_get_b996a12be035ef4f,
+    __wbg_getindex_a471648b3037c750,
+    __wbg_getwithrefkey_1dc361bd10053bfe,
+    __wbg_globalThis_6b4d52a0b6aaeaea,
+    __wbg_global_49324ce12193de77,
+    __wbg_instanceof_ArrayBuffer_ff40e55b5978e215,
+    __wbg_instanceof_Map_0f3f3653f757ced1,
+    __wbg_instanceof_Object_9108547bac1f91b1,
+    __wbg_instanceof_Uint8Array_db97368f94b1373f,
+    __wbg_isArray_8738f1062fa88586,
+    __wbg_isSafeInteger_a1b3e0811faecf2f,
+    __wbg_iterator_c0c688f37fa815e6,
+    __wbg_length_12246a78d2f65d3a,
+    __wbg_length_c24da17096edfe57,
+    __wbg_log_0cc1b7768397bcfe,
+    __wbg_log_0fd6c49475c7bece,
+    __wbg_log_cb9e190acc5753fb,
+    __wbg_lorocounter_new,
+    __wbg_lorolist_new,
+    __wbg_loromap_new,
+    __wbg_loromovablelist_new,
+    __wbg_lorotext_new,
+    __wbg_lorotree_new,
+    __wbg_lorotreenode_new,
+    __wbg_mark_7438147ce31e9d4b,
+    __wbg_measure_fb7825c11612c823,
+    __wbg_msCrypto_0a36e2ec3a343d26,
+    __wbg_new_518e2184725aa711,
+    __wbg_new_59845962d1127937,
+    __wbg_new_67abf4a77618ee3e,
+    __wbg_new_8a6f238a6ece86ea,
+    __wbg_new_e2d07398d7689006,
+    __wbg_newnoargs_a136448eeb7d48ac,
+    __wbg_newwithbyteoffsetandlength_84908302a4c137cf,
+    __wbg_newwithlength_4c216eaaf23f2f9a,
+    __wbg_newwithlength_88b49de1eb24d63e,
+    __wbg_next_928df8c15fc0c9b0,
+    __wbg_next_9dc0926f351c7090,
+    __wbg_node_02999533c4ea02e3,
+    __wbg_now_439b66158bc4f246,
+    __wbg_ownKeys_b16312a839a4152c,
+    __wbg_process_5c1d670bc53614b8,
+    __wbg_push_e7d7247e69dad3ee,
+    __wbg_randomFillSync_ab2cfe79ebbf2740,
+    __wbg_require_79b1e9274cde3c87,
+    __wbg_resolve_267ff08e7e1d2ce4,
+    __wbg_self_cca3ca60d61220f4,
+    __wbg_set_1b50d2de855a9d50,
+    __wbg_set_393f510a6b7e9da5,
+    __wbg_set_3f1d0b984ed272ed,
+    __wbg_set_5deee49b10b2b780,
+    __wbg_set_93ba9407b5476ec6,
+    __wbg_setindex_e0b7b31bfc87ba3f,
+    __wbg_stack_0ed75d68575b0f3c,
+    __wbg_subarray_2dc34705c0dc7cdb,
+    __wbg_then_84907e7a6730461e,
+    __wbg_value_51f8a88d4a1805fb,
+    __wbg_versions_c71aa1626a93e0a1,
+    __wbg_versionvector_new,
+    __wbg_window_2aba046d3fc4ad7c,
+    __wbindgen_as_number,
+    __wbindgen_bigint_from_i64,
+    __wbindgen_bigint_from_u64,
+    __wbindgen_bigint_get_as_i64,
+    __wbindgen_boolean_get,
+    __wbindgen_cb_drop,
+    __wbindgen_closure_wrapper563,
+    __wbindgen_closure_wrapper566,
+    __wbindgen_debug_string,
+    __wbindgen_error_new,
+    __wbindgen_in,
+    __wbindgen_is_array,
+    __wbindgen_is_bigint,
+    __wbindgen_is_falsy,
+    __wbindgen_is_function,
+    __wbindgen_is_null,
+    __wbindgen_is_object,
+    __wbindgen_is_string,
+    __wbindgen_is_undefined,
+    __wbindgen_jsval_eq,
+    __wbindgen_jsval_loose_eq,
+    __wbindgen_memory,
+    __wbindgen_number_get,
+    __wbindgen_number_new,
+    __wbindgen_object_clone_ref,
+    __wbindgen_object_drop_ref,
+    __wbindgen_rethrow,
+    __wbindgen_string_get,
+    __wbindgen_string_new,
+    __wbindgen_throw,
+    __wbindgen_typeof
+};
+
+imports['__wbindgen_placeholder__'] = moduleExports;
 
 const wasmModule = new WebAssembly.Module(bytes);
 const wasmInstance = new WebAssembly.Instance(wasmModule, imports);
 wasm = wasmInstance.exports;
-module.exports.__wasm = wasm;
+export const __wasm = wasm;
+
+// Add main classes and functions to moduleExports after WASM initialization
+Object.assign(moduleExports, {
+    LORO_VERSION,
+    run,
+    encodeFrontiers,
+    decodeFrontiers,
+    setDebug,
+    decodeImportBlobMeta,
+    redactJsonUpdates,
+    AwarenessWasm,
+    ChangeModifier,
+    Cursor,
+    EphemeralStoreWasm,
+    LoroCounter,
+    LoroDoc,
+    LoroList,
+    LoroMap,
+    LoroMovableList,
+    LoroText,
+    LoroTree,
+    LoroTreeNode,
+    UndoManager,
+    VersionVector,
+    __wasm: wasm
+});
 
 wasm.__wbindgen_start();
 
 
 // Don't patch this if it already exists (for example in Deno)
 if (!globalThis.crypto) {
-    // We need this patch because we use `getrandom` crate in Rust, which relies on this patch 
+    // We need this patch because we use `getrandom` crate in Rust, which relies on this patch
     // for nodejs
     // https://docs.rs/getrandom/latest/getrandom/#nodejs-es-module-support
-    const { webcrypto } = require("crypto");
+    // webcrypto already imported at top
     Object.defineProperty(globalThis, 'crypto', {
         value: webcrypto,
         writable: true
diff --git a/package.json b/package.json
index 60cdd125d04eaea10419e0ca707a5c54ff2673a3..07548bfbaa54b137cf3e21b47bc223581c73c2ff 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,7 @@
 {
   "name": "loro-crdt",
   "version": "1.5.9",
+  "type": "module",
   "description": "Loro CRDTs is a high-performance CRDT framework that makes your app state synchronized, collaborative and maintainable effortlessly.",
   "keywords": [
     "crdt",
